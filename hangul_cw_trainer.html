<html>
<head>
<title>한글 CW 연습기</title>
<script type="text/javascript">
/*! hangul-js 2019-12-10 */
!function(){"use strict";var r,d,g,l,t,e,h=["ㄱ",["ㄱ","ㄱ"],"ㄴ","ㄷ",["ㄷ","ㄷ"],"ㄹ","ㅁ","ㅂ",["ㅂ","ㅂ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ",["ㅈ","ㅈ"],"ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],p=["ㅏ","ㅐ","ㅑ",["ㅑ","ㅣ"],"ㅓ","ㅔ","ㅕ",["ㅕ","ㅣ"],"ㅗ",["ㅗ","ㅏ"],["ㅗ","ㅐ"],["ㅗ","ㅣ"],"ㅛ","ㅜ",["ㅜ","ㅓ"],["ㅜ","ㅔ"],["ㅜ","ㅣ"],"ㅠ","ㅡ",["ㅡ","ㅣ"],"ㅣ"],C=["","ㄱ",["ㄱ","ㄱ"],["ㄱ","ㅅ"],"ㄴ",["ㄴ","ㅈ"],["ㄴ","ㅎ"],"ㄷ","ㄹ",["ㄹ","ㄱ"],["ㄹ","ㅁ"],["ㄹ","ㅂ"],["ㄹ","ㅅ"],["ㄹ","ㅌ"],["ㄹ","ㅍ"],["ㄹ","ㅎ"],"ㅁ","ㅂ",["ㅂ","ㅅ"],"ㅅ",["ㅅ","ㅅ"],"ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],A=44032;function n(n){for(var r=n.length,t={0:0},e=0;e<r;e++)n[e]&&(t[n[e].charCodeAt(0)]=e);return t}function o(n){for(var r,t,e=n.length,o={},i=0;i<e;i++)r=n[i][0].charCodeAt(0),t=n[i][1].charCodeAt(0),void 0===o[r]&&(o[r]={}),o[r][t]=n[i][2].charCodeAt(0);return o}function v(n){return void 0!==r[n]}function y(n){return void 0!==d[n]}function m(n){return void 0!==g[n]}function u(n){return void 0!==l[n]}function j(n){return 44032<=n&&n<=55203}function b(n,r){return!(!e[n]||!e[n][r])&&e[n][r]}function S(n,r){return!(!t[n]||!t[n][r])&&t[n][r]}r=n(["ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄸ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅃ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),d=n(["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),g=n(["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"]),l=n(["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"]),t=o([["ㄱ","ㅅ","ㄳ"],["ㄴ","ㅈ","ㄵ"],["ㄴ","ㅎ","ㄶ"],["ㄹ","ㄱ","ㄺ"],["ㄹ","ㅁ","ㄻ"],["ㄹ","ㅂ","ㄼ"],["ㄹ","ㅅ","ㄽ"],["ㄹ","ㅌ","ㄾ"],["ㄹ","ㅍ","ㄿ"],["ㄹ","ㅎ","ㅀ"],["ㅂ","ㅅ","ㅄ"],["ㄱ","ㄱ","ㄲ"],["ㄷ","ㄷ","ㄸ"],["ㅂ","ㅂ","ㅃ"],["ㅅ","ㅅ","ㅆ"],["ㅈ","ㅈ","ㅉ"]]),e=o([["ㅗ","ㅏ","ㅘ"],["ㅗ","ㅐ","ㅙ"],["ㅗ","ㅣ","ㅚ"],["ㅜ","ㅓ","ㅝ"],["ㅜ","ㅔ","ㅞ"],["ㅜ","ㅣ","ㅟ"],["ㅡ","ㅣ","ㅢ"]]);function w(n,r){if(null===n)throw new Error("Arguments cannot be null");"object"==typeof n&&(n=n.join(""));for(var t,e,o,i,u,f=[],c=n.length,a=0;a<c;a++){var s=[];j(i=n.charCodeAt(a))?(e=((i-=A)-(o=i%28))/28%21,t=parseInt((i-o)/28/21),"object"==typeof h[t]?s=s.concat(h[t]):s.push(h[t]),"object"==typeof p[e]?s=s.concat(p[e]):s.push(p[e]),0<o&&("object"==typeof C[o]?s=s.concat(C[o]):s.push(C[o]))):v(i)?"string"==typeof(u=y(i)?h[d[i]]:C[l[i]])?s.push(u):s=s.concat(u):m(i)?"string"==typeof(u=p[g[i]])?s.push(u):s=s.concat(u):s.push(n.charAt(a)),r?f.push(s):f=f.concat(s)}return f}function i(n){return"string"!=typeof n?"":(n=w(n)).join("")}function f(c){"string"==typeof c&&(c=w(c));var n,r,a=[],t=c.length,e=0,s=-1,h=!1;function o(n){var r,t,e,o,i=0,u="";if(h=!1,!(n<s+1))for(var f=1;;f++){if(1===f){if(m(r=c[s+f].charCodeAt(0)))return s+f+1<=n&&m(t=c[s+f+1].charCodeAt(0))?a.push(String.fromCharCode(b(r,t))):a.push(c[s+f]),void(s=n);if(!y(r))return a.push(c[s+f]),void(s=n);u=c[s+f]}else if(2===f){if(y(t=c[s+f].charCodeAt(0)))return r=S(r,t),u=String.fromCharCode(r),a.push(u),void(s=n);u=String.fromCharCode(28*(21*d[r]+g[t])+A)}else 3===f?(b(t,e=c[s+f].charCodeAt(0))?t=b(t,e):i=e,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):4===f?(i=S(i,o=c[s+f].charCodeAt(0))?S(i,o):o,u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A)):5===f&&(i=S(i,o=c[s+f].charCodeAt(0)),u=String.fromCharCode(28*(21*d[r]+g[t])+l[i]+A));if(n<=s+f)return a.push(u),void(s=n)}}for(var i=0;i<t;i++)y(n=c[i].charCodeAt(0))||m(n)||u(n)?(0===e?y(n)?e=1:m(n)&&(e=4):1==e?m(n)?e=2:S(r,n)?e=5:o(i-1):2==e?u(n)?e=3:m(n)?b(r,n)||(o(i-1),e=4):(o(i-1),e=1):3==e?u(n)?!h&&S(r,n)?h=!0:(o(i-1),e=1):y(n)?(o(i-1),e=1):m(n)&&(o(i-2),e=2):4==e?m(n)?b(r,n)?(o(i),e=0):o(i-1):(o(i-1),e=1):5==e&&(e=m(n)?(o(i-2),2):(o(i-1),1)),r=n):(o(i-1),o(i),e=0);return o(i-1),a.join("")}function c(n){this.string=n,this.disassembled=w(n).join("")}c.prototype.search=function(n){return w(n).join("").indexOf(this.disassembled)};var a={disassemble:w,d:w,disassembleToString:i,ds:i,assemble:f,a:f,search:function(n,r){var t=w(n).join(""),e=w(r).join("");return t.indexOf(e)},rangeSearch:function(n,r){var t,e=w(n).join(""),o=w(r).join(""),i=w(n,!0),u=new RegExp(o,"gi"),f=[];if(!r.length)return[];for(;t=u.exec(e);)f.push(t.index);return f.map(function(n){return[function(n){for(var r=0,t=0;r<i.length;++r)if(n<(t+=i[r].length))return r}(n),function(n){for(var r=0,t=0;r<i.length;++r)if(t+=i[r].length,n+o.length<=t)return r}(n)]})},Searcher:c,endsWithConsonant:function(n){"object"==typeof n&&(n=n.join(""));var r=n.charCodeAt(n.length-1);if(j(r)){if(0<(r-=A)%28)return!0}else if(v(r))return!0;return!1},endsWith:function(n,r){return w(n).pop()===r},isHangul:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isComplete:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),j(n)},isConsonant:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),v(n)},isVowel:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),m(n)},isCho:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),y(n)},isJong:function(n){return"string"==typeof n&&(n=n.charCodeAt(0)),u(n)},isHangulAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isCompleteAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!j(n.charCodeAt(r)))return!1;return!0},isConsonantAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!v(n.charCodeAt(r)))return!1;return!0},isVowelAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!m(n.charCodeAt(r)))return!1;return!0},isChoAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!y(n.charCodeAt(r)))return!1;return!0},isJongAll:function(n){if("string"!=typeof n)return!1;for(var r=0;r<n.length;r++)if(!u(n.charCodeAt(r)))return!1;return!0}};"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module?module.exports=a:window.Hangul=a}();
</script>
<style>
body {
    background-color: white ;
    font-family: 'Maven Pro', 'sans serif';
    font-size: large;
}
#page {
    width: 90%;
    margin-left: auto;
    margin-right: auto;
    padding: 1em;
    border-radius: 19px;
}
p {
    padding: 4px;
    background: white;
    color: black;
}
input {
    padding: 4px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Maven Pro', 'sans serif';
    font-size: large;
}
input:focus { 
    border: 1px solid teal;
    box-shadow: 0 0 5px 1px powderblue;
}
button {
    color: black;
    font-family: 'Maven Pro', 'sans serif';
    font-size: large;
}
#freq { 
    width: 3em;
}
#speed {
    width: 3em;
}
#volume {
    width: 3em;
}
#morse {
    width : 100%;
    height : 50%;
    padding: 10px;
    border: 1px solid lightsalmon;
    transition: box-shadow 0.3s;
    background: lightyellow;
    border-radius: 5px;
    color: black;
    font-family: 'Maven Pro', 'sans serif';
    font-size: large;
    line-height: 2em;
}
#counter {
    float: right;
}
.font_medium {
    font-size : medium;
}
</style>
</head>
<body><div id="page">
<p>
<h2>한글 CW 연습기 by DS1TZE</h2>
</p>
<p>
Frequency : <input type="number" id="freq" value="600" step="10" size="4" min="200" max="1200" />Hz
&nbsp;
Speed : <input type="number" id="speed" value="20" size="2" min="5" max="50" />wpm
&nbsp;
Volume : <input type="number" id="volume" min="10" max="100" value="100" step="10" />%
&nbsp;
Extra Gap : <label><input type="radio" name="key" value="computer" checked /> no gap</label>
<label><input type="radio" name="key" value="elmer" /> small</label>
<label><input type="radio" name="key" value="farnsworth" /> large</label>
&nbsp; &nbsp;
<button id="play">PLAY</button>
<button id="stop">STOP</button>
&nbsp; &nbsp;
<label><input type="checkbox" id="selection_only" /> Play selection only</label>
</p>
<textarea id="morse">
HL2LKL DE HL1SB K     
HL1SB DE HL2LKL BT KA 유 오엠님 BT 안녕하세요? 신호는 599 599입니다. AR HL1SB DE HL2LKL K     
HL2LKL DE HL1SB BT KA KA 전 오엠님 또 만나뵙게 되어 반갑습니다, 신호 역시 599 좋습니다, 지금 저의 출력은 20와트 20와트 입니다, 공간상태가 좋아서 저출력인데도 신호가 잘 들어가는 것 같아서 다행입니다. AR HL2LKL DE HL1SB K     
HL1SB DE HL2LKL BT KA 예, 오엠님 몇일만에 만나서 반갑습니다 BT 예, 오늘은 공간상태가 좋아서 BT 저 출력인 20왓트로 송신하시는 데도 BT 안산에 아주 강력하게 신호가 들어옵니다 BT 저는 현재 출력이 백왓트입니다. AR HL1SB DE HL2LKL K     
R HL2LKL DE HL1SB BT KA BT 예, 전 오엠님 잘 수신했습니다, 오엠님 신호는 언제나 이곳에서 잘 수신되고 있습니다 HI HI BT 제가 지금 사용하고 있는 장비는 메인 장비가 아니고, 포터블용 저출력 장비라서, 최대출력이 20왓트밖에 안 됩니다, 주로 이 장비를 전신 교신에 사용하고 있습니다. AR HL2LKL DE HL1SB K     
HL1SB DE HL2LKL BT KA 예, 오엠님 말씀 잘 수신했습니다 BT 오엠님께서는 아주 예전 장비를 사용하시네요 BT 출력이 최대가 20왓트 장비이시네요 BT 그러나 음질도 아주 좋습니다 BT 예전 장비를 사용하시는 오엠님을 만나면 부럽습니다 BT 저는 아이콤 IC7300 IC7300 장비를 사용하고 있습니다 BT 안테나는 십오층 옥상에 다이폴을 사용하고 있습니다 BT 다행히 관리사무소에서 승인하여서요 BT 안테나는 안산 오엠님들이 오셔서 설치해 주었습니다. AR HL1SB DE HL2LKL K     
HL2LKL DE HL1SB BT KA BT 예, 전 오엠님 잘 수신했습니다, 제 장비는 옛날 장비는 아니고요, 비교적 최신 장비이긴 한데, 중국제 소형 SDR SDR 장비입니다, 오엠님께서 사용하시는 장비도 SDR 장비죠 HI HI BT 오엠님의 안테나도 15층 옥상에 설치한 다이폴이군요, 저도 15층 옥상에 안테나를 설치했습니다, 삼점오와 칠메가 용 다이폴입니다 HI HI BT 전 오엠님, 오늘 이렇게 또 다시 만나서 롱큐에스오 하게 되어 즐거웠습니다, 무더운 날씨에 무탈하게 계시기 바랍니다, 다음에 뵐 때까지 안녕히 계시기 바랍니다. AR HL2LKL DE HL1SB K     
HL1SB DE HL2LKL BT KA 예, 오엠님께서 사용하시는 장비는 최근 장비이시군요 BT 중국의 SDR 장비이시라고 수신하였습니다 BT 안테나도 15층에 설치하셨고요 BT 오엠님 무더운 날씨에 건강 조심하시고요 BT 또 만날 때까지 안녕히 계십시요. AR HL1SB DE HL2LKL GL GB TU VA E E     
R FB HL2LKL DE HL1SB BT KA 예, 전 오엠님 오늘 교신 정말 감사했습니다, 그럼 이만 실례합니다, 안녕히 계세요 73 HL2LKL DE HL1SB 73 TU TU E E     
OK BT KA 예, 오엠님 제가 더 교신을 할 수가 있어서 영광이었습니다 BT 앞으로 자주 만나뵙겠습니다 BT 또 만나면 아마추어에 대해 한수를 가르쳐주세요 HI HI BT 안녕히 계세요. AR HL1SB DE HL2LKL GL GB 73 TU TU E E     
OK DE HL1SB BT KA BT 아이고 오엠님, 가르쳐 드리다뇨 HI 오엠님께서는 이미 고수이신데요 HI HI 73 HL2LKL DE HL1SB 73 TU TU E E     
QSL DR OM TNX FB QSO HPE CUAGN BT AR HL1SB DE HL2LKL 73 TU E E   
73 GB TU TU E E   
TU  
E   
E   
</textarea>
※ 예문 출처 : <a href="https://www.youtube.com/watch?v=TkbhZqdAPdw" target="_blank">https://www.youtube.com/watch?v=TkbhZqdAPdw</a>

<p>
    <h3>Intro.</h3><br />
    안녕하세요. DS1TZE 입니다.<br /><br />
    위 프로그램은 한글 CW 청취 연습기입니다.<br />영문과 숫자를 포함해 원하는 내용을 입력하고 PLAY 버튼을 누르면 모스 부호로 들려줍니다.<br />
    CW 청취 연습에 유용한 웹사이트인 Seiuchy를 사용하던 중, 그 근간이 되는 모스 코드 생성 라이브러리를 알게 되어, 한글 자모 분해 라이브러리를 붙여 만들게 되었습니다.<br />
    많은 활용 바라며, 건의 사항은 온에어에서 말씀해주시기 바랍니다.<br />
    <br />
    <br />
    
    <h3>Links</h3><br />
    Seiuchy - <a href="http://seiuchy.macache.com/" target="_blank">http://seiuchy.macache.com/</a><br />
    Morse Code generator Javascript 라이브러리 - <a href="https://gist.github.com/eholk/0115691987090973cefe" target="_blank">https://gist.github.com/eholk/0115691987090973cefe</a><br />
    위 라이브러리 제작 관련 글 - <a href="https://blog.theincredibleholk.org/blog/2014/06/23/generating-morse-code-with-javascript/" target="_blank">https://blog.theincredibleholk.org/blog/2014/06/23/generating-morse-code-with-javascript/</a><br />
    위 라이브러리가 사용하는 기술인 Web Audio API - <a href="https://webaudio.github.io/web-audio-api/" target="_blank">https://webaudio.github.io/web-audio-api/<a/><br />
    한글 자모 분해 Javascipt 라이브러리* - <a href="https://github.com/e-/Hangul.js/" target="_blank">https://github.com/e-/Hangul.js/</a><br />
    ※ 한글 CW는 26개 부호만 사용하기 때문에, 라이브러리를 살짝 수정해 "ㅖ"와 "ㅒ"는 각각 "ㅕ" + "ㅣ" 및 "ㅑ" + "ㅣ" 로 분해하도록 하고, 같은 홑낱자로 이루어진 겹낱자도 분해하도록 했습니다.<br />
    <br />
    <br />

    <h3>DE DS1TZE - <a href="https://www.qrz.com/db/DS1TZE" target="_blank" class="font_medium">https://www.qrz.com/db/DS1TZE</a>
	<span id="counter">
        <a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fshingiru.github.io%2Fhangul_cw_trainer.html&count_bg=%2379C83D&title_bg=%23555555&icon=&icon_color=%23E7E7E7&title=hits&edge_flat=false"/></a>
    </span>
	</h3>
    
</p>
<script type="text/javascript">
function MorseNode(ac, rate) {
    // ac is an audio context.
    this._oscillator = ac.createOscillator();
    this._gain = ac.createGain();

    this._gain.gain.value = 0;
    this._oscillator.type = 'sine';
    this._oscillator.frequency.value = 600;

    this._oscillator.connect(this._gain);
    this.key = 'computer';

    if (rate == undefined)
        rate = 20;
    this._dot = 1.2 / rate; // formula from Wikipedia.

    this._oscillator.start(0);
}

MorseNode.prototype.connect = function(target) {
    return this._gain.connect(target);
}

MorseNode.prototype.MORSE = {
    "A": ".-",
    "B": "-...",
    "C": "-.-.",
    "D": "-..",
    "E": ".",
    "F": "..-.",
    "G": "--.",
    "H": "....",
    "I": "..",
    "J": ".---",
    "K": "-.-",
    "L": ".-..",
    "M": "--",
    "N": "-.",
    "O": "---",
    "P": ".--.",
    "Q": "--.-",
    "R": ".-.",
    "S": "...",
    "T": "-",
    "U": "..-",
    "V": "...-",
    "W": ".--",
    "X": "-..-",
    "Y": "-.--",
    "Z": "--..",

    "1": ".----",
    "2": "..---",
    "3": "...--",
    "4": "....-",
    "5": ".....",
    "6": "-....",
    "7": "--...",
    "8": "---..",
    "9": "----.",
    "0": "-----",
    
    ".": ".-.-.-",
    ",": "--..--",
    "?": "..--..",
    "/": "-..-.",
    "+": ".-.-.",
    "-": "-....-",
    "=": "-...-",
    ":": "---...",
    ";": "-.-.-.",
    "(": "-.--.",
    ")": "-.--.-",
    "'": ".----.",
    "\"": ".-..-.",
    "@": ".--.-.",
    
    "ㄱ": ".-..",
    "ㄴ": "..-.",
    "ㄷ": "-...",
    "ㄹ": "...-",
    "ㅁ": "--",
    "ㅂ": ".--",
    "ㅅ": "--.",
    "ㅇ": "-.-",
    "ㅈ": ".--.",
    "ㅊ": "-.-.",
    "ㅋ": "-..-",
    "ㅌ": "--..",
    "ㅍ": "---",
    "ㅎ": ".---",
    "ㅏ": ".",
    "ㅑ": "..",
    "ㅓ": "-",
    "ㅕ": "...",
    "ㅗ": ".-",
    "ㅛ": "-.",
    "ㅜ": "....",
    "ㅠ": ".-.",
    "ㅡ": "-..",
    "ㅣ": "..-",
    "ㅔ": "-.--",
    "ㅐ": "--.-"
};

MorseNode.prototype.dotfac = function(t) {
    switch (this.key) {
            // t is type of dotvalue.  l=letter int. i=inter el. s=spaces .=dit -=dah 
        case 'computer':
            return 1;
        case 'farnsworth': //uses farnsworth
            if (t=='s') return 6;
            if (t=='l') return 4;
        case 'elmer': //uses farnsworth
            if (t=='s') return 4;
            if (t=='l') return 1.5;
            return 1;
        }

}

MorseNode.prototype.playChar = function(t, c) {
    for (var i = 0; i < c.length; i++) {
        switch(c[i]) {
        case '.':
            this._gain.gain.setValueAtTime(1.0 * volume, t);
            t += this._dot * this.dotfac('.');
            this._gain.gain.setValueAtTime(0.0, t);
            break;
        case '-':
            this._gain.gain.setValueAtTime(1.0 * volume, t);
            t += 3 * this._dot * this.dotfac('-');
            this._gain.gain.setValueAtTime(0.0, t);
            break;
        }
        t += this._dot * this.dotfac('i');
    }
    return t;
}

MorseNode.prototype.playString = function(t, w) {
    this.key = document.querySelector('input[name="key"]:checked').value;
    
    w = Hangul.disassemble(w.toUpperCase());
    for (var i = 0; i < w.length; i++) {
        if(w[i] == ' ') {
            t += 3 * this._dot * this.dotfac('s'); // 3 dots from before, three here, and
                                // 1 from the ending letter before.
        }
        else if(this.MORSE[w[i]] != undefined) {
            t = this.playChar(t, this.MORSE[w[i]]);
            t += 2 * this._dot * this.dotfac('l');
        }
    }
    return t;
}



var filter, ac, morse, inited = false, volume = 1.0;

var freq = document.querySelector("#freq")
var wpm = document.querySelector("#speed");
var volctl=document.querySelector("#volume");
var play = document.querySelector("#play");
var stop = document.querySelector("#stop");
var txt = document.querySelector("#morse");
var selection_only = document.querySelector("#selection_only");

function init() {
    ac = new (window.AudioContext || window.webkitAudioContext)();  
    morse = new MorseNode(ac, parseInt(wpm.value));
    
    filter = ac.createBiquadFilter(); 
    filter.frequency.value = freq.value;
    filter.Q.value = 0;
    filter.gain.value = 0.5;
    
    morse.connect(filter);
    filter.connect(ac.destination);
    
    inited = true;
}
stop.onclick = function() {
    if (!inited) init();
    
    morse._oscillator.stop(0)
    morse = new MorseNode(ac, parseInt(wpm.value));
    morse.connect(filter);
    filter.connect(ac.destination);
    
    morse._dot = 1.2 / parseFloat(wpm.value);
    morse._oscillator.frequency.value = parseInt(freq.value);
    morse.playString(ac.currentTime, " ");
	
	txt.disabled = false;
	txt.focus();
}
play.onclick = function() {
    if (!inited) init();
    
    morse._oscillator.stop(0)
    morse = new MorseNode(ac, parseInt(wpm.value));
    morse.connect(filter);
    filter.connect(ac.destination);
    
    morse._dot = 1.2 / parseFloat(wpm.value);
    morse._oscillator.frequency.value = parseInt(freq.value);
	
	txt.focus();
	txt.disabled = true;
	
    if (selection_only.checked) {
        morse.playString(ac.currentTime, txt.value.substring(txt.selectionStart, txt.selectionEnd));
    } else {
        morse.playString(ac.currentTime, " vvv " + txt.value);
    }
}
volctl.onchange = function() {
    volume = volctl.value / 100.0;
}
</script>
<p class="font_medium">
<h3>Change Log</h3>
2022.08.13. "Play selection only" support.<br />
2022.08.12. First version of Hangul CW Trainer.<br />
</p>
</div>
</body>
</html>
